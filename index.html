<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Landing Page JSON Builder</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header>
    <!-- We add a container so we can place the title on the left 
         and the dark mode toggle on the right -->
    <div class="header-content">
      <h1>Landing Page JSON Builder</h1>
      <button id="darkModeToggle">Dark Mode</button>
    </div>
  </header>

  <!-- TOP ROW: Available vs. Selected -->
  <div class="container">
    <!-- LEFT PANEL: Available Components -->
    <div class="panel">
      <h2>Available Components</h2>
      <div id="availableComponents" class="available-components">
        <!-- Populated by JS -->
      </div>
    </div>

    <!-- RIGHT PANEL: Selected Components -->
    <div class="panel selected-panel">
      <h2>Selected Components</h2>
      <div id="selectedList" class="selected-list">
        <!-- Populated by JS -->
      </div>
      <button class="export-btn" id="exportBtn">Export JSON</button>
    </div>
  </div>

  <!-- BOTTOM ROW #1: Component Fields Panel -->
  <div class="form-editor" id="formEditor">
    <h2>Component Fields</h2>
    <div id="formsContainer"></div>
  </div>

  <!-- BOTTOM ROW #2: JSON Output Panel -->
  <div class="json-output-panel">
    <h2>JSON Output</h2>
    <pre id="jsonOutput"></pre>
  </div>

  <script>
    // Dark Mode Toggle
    const darkToggleBtn = document.getElementById('darkModeToggle');
    darkToggleBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      // Optional: update button text
      if (document.body.classList.contains('dark-mode')) {
        darkToggleBtn.textContent = 'Light Mode';
      } else {
        darkToggleBtn.textContent = 'Dark Mode';
      }
    });

    // ------- Variables -------
    let componentsDefs = [];
    let selectedComponents = []; // array of { definition: {...}, data: {...} }

    // ------- Load Definitions -------
    fetch('./components.json')
      .then(res => res.json())
      .then(data => {
        componentsDefs = data;
        renderAvailableComponents();
      })
      .catch(err => console.error('Error loading components.json:', err));

    // Render "Available Components" (Left Panel)
    function renderAvailableComponents() {
      const container = document.getElementById('availableComponents');
      container.innerHTML = '';

      componentsDefs.forEach(def => {
        const btn = document.createElement('button');
        btn.textContent = def.componentName;
        btn.addEventListener('click', () => addComponent(def));
        container.appendChild(btn);
      });
    }

    // Add a component to the selected list
    function addComponent(def) {
      const dataObj = {};
      def.fields.forEach(f => { dataObj[f.name] = ''; });
      selectedComponents.push({ definition: def, data: dataObj });

      renderSelectedList();
      renderForms();
    }

    // Render the "Selected Components" (Right Panel)
    function renderSelectedList() {
      const listEl = document.getElementById('selectedList');
      listEl.innerHTML = '';

      selectedComponents.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'selected-item';

        const span = document.createElement('span');
        span.textContent = (index + 1) + ') ' + item.definition.componentName;

        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'actions';

        // Move Up
        const btnUp = document.createElement('button');
        btnUp.textContent = '↑';
        btnUp.disabled = (index === 0);
        btnUp.addEventListener('click', () => moveComponentUp(index));
        actionsDiv.appendChild(btnUp);

        // Move Down
        const btnDown = document.createElement('button');
        btnDown.textContent = '↓';
        btnDown.disabled = (index === selectedComponents.length - 1);
        btnDown.addEventListener('click', () => moveComponentDown(index));
        actionsDiv.appendChild(btnDown);

        // Remove
        const btnRemove = document.createElement('button');
        btnRemove.textContent = 'Remove';
        btnRemove.addEventListener('click', () => removeComponent(index));
        actionsDiv.appendChild(btnRemove);

        div.appendChild(span);
        div.appendChild(actionsDiv);
        listEl.appendChild(div);
      });
    }

    function moveComponentUp(index) {
      if (index === 0) return;
      [selectedComponents[index - 1], selectedComponents[index]] =
        [selectedComponents[index], selectedComponents[index - 1]];
      renderSelectedList();
      renderForms();
    }

    function moveComponentDown(index) {
      if (index === selectedComponents.length - 1) return;
      [selectedComponents[index + 1], selectedComponents[index]] =
        [selectedComponents[index], selectedComponents[index + 1]];
      renderSelectedList();
      renderForms();
    }

    function removeComponent(index) {
      selectedComponents.splice(index, 1);
      renderSelectedList();
      renderForms();
    }

    // Render the form fields for each selected component (bottom "Component Fields" panel)
    function renderForms() {
      const container = document.getElementById('formsContainer');
      container.innerHTML = '';

      selectedComponents.forEach((item, idx) => {
        const formDiv = document.createElement('div');
        formDiv.className = 'component-form';

        const title = document.createElement('h3');
        title.textContent = (idx + 1) + ') ' + item.definition.componentName + ' Fields';
        formDiv.appendChild(title);

        // For each field, create a label + input
        item.definition.fields.forEach(field => {
          const fieldGroup = document.createElement('div');
          fieldGroup.className = 'field-group';

          const label = document.createElement('label');
          label.textContent = field.label;

          const input = document.createElement('input');
          input.type = field.type || 'text';
          input.value = item.data[field.name];
          input.placeholder = 'Enter ' + field.label;
          input.addEventListener('input', (e) => {
            item.data[field.name] = e.target.value;
          });

          fieldGroup.appendChild(label);
          fieldGroup.appendChild(input);
          formDiv.appendChild(fieldGroup);
        });

        container.appendChild(formDiv);
      });
    }

    // EXPORT JSON
    document.getElementById('exportBtn').addEventListener('click', () => {
      const outputArray = selectedComponents.map(sc => ({
        componentName: sc.definition.componentName,
        fields: { ...sc.data }
      }));

      const finalJson = { landingPage: outputArray };
      document.getElementById('jsonOutput').textContent = JSON.stringify(finalJson, null, 2);
    });
  </script>
</body>
</html>
