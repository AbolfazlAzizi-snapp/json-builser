<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Landing Page JSON Builder</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header>
    <h1>Landing Page JSON Builder</h1>
  </header>

  <div class="container">
    <!-- LEFT PANEL: AVAILABLE COMPONENTS -->
    <div class="panel">
      <h2>Available Components</h2>
      <div id="availableComponents" class="available-components">
        <!-- Dynamically filled by JS -->
      </div>
    </div>

    <!-- RIGHT PANEL: SELECTED COMPONENTS -->
    <div class="panel selected-panel">
      <h2>Selected Components</h2>
      <div id="selectedList" class="selected-list">
        <!-- Dynamically filled by JS -->
      </div>
      <button class="export-btn" id="exportBtn">Export JSON</button>
    </div>
  </div>

  <!-- FORM EDITOR (spans both columns) -->
  <div class="form-editor" id="formEditor">
    <h2>Component Fields</h2>
    <div id="formsContainer"></div>

    <!-- Optional: Show final JSON output here when user clicks Export -->
    <pre id="jsonOutput"></pre>
  </div>

  <script>
    /* 
      Vanilla JS for:
      1. Fetching 'components.json'
      2. Rendering 'Available Components' as buttons
      3. Letting user add multiple selected components
      4. Reordering them (up/down)
      5. Dynamically building form inputs
      6. Exporting final JSON
    */

    let componentsDefs = [];
    let selectedComponents = []; // e.g. [{ definition, data }, ...]

    // 1. Load the component definitions
    fetch('./components.json')
      .then(res => res.json())
      .then(data => {
        componentsDefs = data;
        renderAvailableComponents();
      })
      .catch(err => console.error('Error loading components.json:', err));

    // Render "Available Components" as buttons
    function renderAvailableComponents() {
      const container = document.getElementById('availableComponents');
      container.innerHTML = '';

      componentsDefs.forEach(def => {
        const btn = document.createElement('button');
        btn.textContent = def.componentName;
        btn.addEventListener('click', () => addComponent(def));
        container.appendChild(btn);
      });
    }

    // Add a component to the selected list
    function addComponent(def) {
      const dataObj = {};
      def.fields.forEach(f => {
        dataObj[f.name] = ''; // default blank
      });

      selectedComponents.push({ definition: def, data: dataObj });
      renderSelectedList();
      renderForms();
    }

    // Render the "Selected Components" list (right panel)
    function renderSelectedList() {
      const listEl = document.getElementById('selectedList');
      listEl.innerHTML = '';

      selectedComponents.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'selected-item';

        // Label: e.g., "1) hero-section"
        const span = document.createElement('span');
        span.textContent = (index + 1) + ') ' + item.definition.componentName;

        // Action buttons (Up, Down, Remove)
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'actions';

        // Move Up
        const btnUp = document.createElement('button');
        btnUp.textContent = '↑';
        btnUp.disabled = (index === 0);
        btnUp.addEventListener('click', () => moveComponentUp(index));
        actionsDiv.appendChild(btnUp);

        // Move Down
        const btnDown = document.createElement('button');
        btnDown.textContent = '↓';
        btnDown.disabled = (index === selectedComponents.length - 1);
        btnDown.addEventListener('click', () => moveComponentDown(index));
        actionsDiv.appendChild(btnDown);

        // Remove
        const btnRemove = document.createElement('button');
        btnRemove.textContent = 'Remove';
        btnRemove.addEventListener('click', () => removeComponent(index));
        actionsDiv.appendChild(btnRemove);

        div.appendChild(span);
        div.appendChild(actionsDiv);
        listEl.appendChild(div);
      });
    }

    function moveComponentUp(index) {
      if (index === 0) return;
      const temp = selectedComponents[index];
      selectedComponents[index] = selectedComponents[index - 1];
      selectedComponents[index - 1] = temp;
      renderSelectedList();
      renderForms();
    }

    function moveComponentDown(index) {
      if (index === selectedComponents.length - 1) return;
      const temp = selectedComponents[index];
      selectedComponents[index] = selectedComponents[index + 1];
      selectedComponents[index + 1] = temp;
      renderSelectedList();
      renderForms();
    }

    function removeComponent(index) {
      selectedComponents.splice(index, 1);
      renderSelectedList();
      renderForms();
    }

    // Render the form fields for each selected component
    function renderForms() {
      const container = document.getElementById('formsContainer');
      container.innerHTML = '';

      selectedComponents.forEach((item, idx) => {
        // Card container
        const formDiv = document.createElement('div');
        formDiv.className = 'component-form';

        // Title: e.g., "1) hero-section Fields"
        const title = document.createElement('h3');
        title.textContent = (idx + 1) + ') ' + item.definition.componentName + ' Fields';
        formDiv.appendChild(title);

        // For each field in the component definition
        item.definition.fields.forEach(field => {
          const fieldGroup = document.createElement('div');
          fieldGroup.className = 'field-group';

          const label = document.createElement('label');
          label.textContent = field.label;

          const input = document.createElement('input');
          input.type = field.type || 'text';
          input.value = item.data[field.name];
          input.placeholder = 'Enter ' + field.label;
          input.addEventListener('input', (e) => {
            item.data[field.name] = e.target.value;
          });

          fieldGroup.appendChild(label);
          fieldGroup.appendChild(input);
          formDiv.appendChild(fieldGroup);
        });

        container.appendChild(formDiv);
      });
    }

    // EXPORT JSON
    document.getElementById('exportBtn').addEventListener('click', () => {
      // Build final JSON array
      const outputArray = selectedComponents.map(item => ({
        componentName: item.definition.componentName,
        fields: { ...item.data }
      }));

      // Example final structure
      const finalJson = { landingPage: outputArray };

      // Show in <pre> block
      const outputEl = document.getElementById('jsonOutput');
      outputEl.textContent = JSON.stringify(finalJson, null, 2);
    });
  </script>
</body>
</html>
